/**
 * PB Video Block
 * Front-End SCSS
 **/

.pb-video-block {
	--pb-video-overlay-bg: rgba(0, 0, 0, 0.35);
	--pb-video-overlay-text: #fff;

	position: relative;
	width: 100%;
	aspect-ratio: 16 / 9; // Fallback for modern browsers
	overflow: hidden;
	container-type: inline-size;
	margin-bottom: 0 !important;
	box-sizing: border-box;
	opacity: 0;
	transform: translateY(20px);
	transition:
		opacity 0.6s ease,
		transform 0.6s ease;

	&.drop-shadow {
		box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
		transition: box-shadow 0.3s ease-in-out;
	}

	&.aspect-21-9 {
		aspect-ratio: 21 / 9;
	}

	&.aspect-16-9 {
		aspect-ratio: 16 / 9;
	}

	&.aspect-9-16 {
		aspect-ratio: 9 / 16;
	}

	&.aspect-4-3 {
		aspect-ratio: 4 / 3;
	}

	&.aspect-3-2 {
		aspect-ratio: 3 / 2;
	}

	&.aspect-1-1 {
		aspect-ratio: 1 / 1;
	}

	&-img.pb-video-block-img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
		box-sizing: border-box;
	}

	.pb-video-placeholder {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: auto;
		aspect-ratio: inherit;
		background: #f3f3f3;
		overflow: hidden;
	}

	.pb-video-placeholder .pb-video-missing {
		color: #999;
		font-size: 1rem;
		text-align: center;
		opacity: 0.8;
	}

	.video-overlay {
		position: absolute;
		inset: 0;
		display: flex;
		pointer-events: none;
		overflow: hidden;

		.overlay-content {
			transform: translateY(100%);
			opacity: 0;
			transition:
				transform 0.35s ease,
				opacity 0.35s ease;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			width: 100%;
			height: 100%;
		}
	}

	.video-title-overlay,
	.video-play-button svg {
		color: white !important;
		fill: currentcolor;
		stroke: currentcolor;
		text-shadow: 0 0 4px rgba(0, 0, 0, 0.7);
		transition: opacity 0.3s ease;
		pointer-events: none;
	}

	&.has-color-overlay {

		.video-title-overlay,
		.video-play-button svg {
			color: var(--pb-video-overlay-text, #fff) !important;
		}
	}

	.video-title-overlay {
		font-size:
 clamp(0.9rem, 5cqi, 1.8rem); // 5cqi = 5% of container inline size
		font-weight: 600;
		margin-bottom: 10px;
		max-width: 90%;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.video-play-button {
		font-size:
 clamp(0.9rem, 5cqi, 1.8rem); // 5cqi = 5% of container inline size
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.video-play-button svg {
		width: 1em;
		height: 1em;
	}

	// Visibility logic
	.video-title-overlay.onHover,
	.video-play-button.onHover {
		opacity: 0;
	}

	&:hover .video-title-overlay.onHover,
	&:hover .video-play-button.onHover {
		opacity: 1;
	}

	.video-title-overlay.always,
	.video-play-button.always {
		opacity: 1;
	}

	.video-title-overlay.hidden,
	.video-play-button.hidden {
		display: none;
	}

	&:focus-visible {
		outline: 2px solid var(--wp--preset--color--accent, #007cba);
		outline-offset: 2px;
	}
}

.has-overlay-always .video-overlay .overlay-content,
.has-overlay-hover:hover .video-overlay .overlay-content {
	transform: translateY(0%);
	opacity: 1;
}

.has-overlay-always .video-overlay {
	background: var(--pb-video-overlay-bg, rgba(0, 0, 0, 0.35));
}

.has-overlay-hover:hover .video-overlay {
	background: var(--pb-video-overlay-bg, rgba(0, 0, 0, 0.35));
}

.has-blur-overlay.has-overlay-hover:hover .video-overlay {
	background: rgba(0, 0, 0, 0.65);
	backdrop-filter: blur(6px);
	-webkit-backdrop-filter: blur(6px);
}

// WooCommerce Add to Cart Button Styles
.pb-video-block {

	.pb-video-add-to-cart {
		color: var(--pb-cart-icon-color, currentColor);
		background-color: var(--pb-cart-icon-bg, transparent);
		width: 24px;
		height: 24px;
		position: absolute;
		top: calc(8px + var(--pb-border-width, 0px));
		right: calc(8px + var(--pb-border-width, 0px));
		display: flex;
		align-items: center;
		justify-content: center;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		transition: opacity 0.3s ease;
		z-index: 10;
		padding-inline-start: 0 !important;
		padding-inline-end: 0 !important;
		padding-block-start: 0 !important;
		padding-block-end: 0 !important;

		svg {
			width: 100%;
			height: 100%;
			object-fit: contain;
			margin: auto;
		}

		&.hover-only {
			opacity: 0;
		}
	}

	&:hover .pb-video-add-to-cart.hover-only,
	&:focus-within .pb-video-add-to-cart.hover-only {
		opacity: 1;
	}
}

// Lightbox Styles
// Base Lightbox Layout

.pb-video-lightbox {
	opacity: 0;
	visibility: hidden;
	transition: opacity 0.3s ease;
	align-items: center;
	backdrop-filter: blur(6px);
	-webkit-backdrop-filter: blur(6px);
	background: rgba(0, 0, 0, 0.9);
	display: flex;
	inset: 0;
	justify-content: center;
	position: fixed !important;
	top: 0;
	left: 0;
	width: 100vw;
	height: 100vh;
	z-index: 9999;

	&.active {
		display: flex;
		opacity: 1;
		visibility: visible;
	}

	.pb-video-lightbox-inner {
		position: relative;
		width: 90%;
		max-width: 80%;
		max-height: 80vh;
		overflow: hidden;
	}

	.pb-video-lightbox-video {
		position: relative;
		padding-top: 56.25%;

		iframe,
		video {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			border: none;
		}
	}

	.pb-video-lightbox-close {
		background: transparent;
		position: fixed;
		top: 20px;
		right: 20px;
		border: none;
		color: #fff;
		font-size: 28px;
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		z-index: 10000;
	}
}

// Shared layout logic
.pb-video-lightbox.split-layout,
.pb-video-lightbox.video-product-layout {

	.pb-video-lightbox-inner {
		--pb-lightbox-gap: clamp(1rem, 2vw, 2rem);
		display: flex;
		align-items: stretch;
		justify-content: center;
		gap: var(--pb-lightbox-gap);
	}

	.pb-video-lightbox-video {
		flex: 0 1 calc(70% - (var(--pb-lightbox-gap) / 2));
		min-width: 0;
	}

	.pb-video-lightbox-info {
		flex: 0 1 calc(30% - (var(--pb-lightbox-gap) / 2));
		min-width: 0;
		color: #fff;
		overflow-y: auto;
		max-height: 80vh;

		h2.pb-video-lightbox-title {
			font-size: clamp(1rem, 2vw + 0.5rem, 2rem);
			font-weight: 600;
			margin-bottom: 1rem;
			line-height: 1.2;
		}

		p.pb-video-lightbox-description {
			font-size: clamp(0.875rem, 1.2vw + 0.4rem, 1.125rem);
			line-height: 1.6;
			margin: 0;
		}

		.pb-view-product-button {
			color: #fff;
			border: 1px solid #fff;
			padding: 0.5rem 1rem;
			border-radius: 8px;
			text-decoration: none;
		}
	}
}

// Video + Product Layout (unique differences)
.pb-video-lightbox.video-product-layout {
	.pb-video-lightbox-info {
		padding: 2rem;
		text-align: left;

		img.pb-video-lightbox-product-image {
			width: 100%;
			height: auto;
			border-radius: 6px;
			margin-bottom: 1rem;
		}

		h2.pb-video-lightbox-product-title {
			margin: 0 0 0.5rem;
			font-size: 1.5rem;
		}

		.pb-video-lightbox-product-price {
			font-weight: 600;
			margin-bottom: 1rem;
		}

		.pb-lightbox-product-info p {
			font-size: 1rem;
			line-height: 1.6;
		}

		a.pb-video-lightbox-product-button {
			display: inline-block;
			margin-top: 1rem;
			padding: 0.6rem 1rem;
			color: #fff;
			background: #000;
			border: 1px solid #fff;
			border-radius: 4px;
			font-weight: 600;
			text-decoration: none;

			&:hover {
				background: #eee;
				color: #000;
			}
		}
	}
}

// Responsive
@media (max-width: 768px) {

	.pb-video-lightbox.split-layout .pb-video-lightbox-inner,
	.pb-video-lightbox.video-product-layout .pb-video-lightbox-inner {
		flex-direction: column;
	}
}

.pb-video-lightbox-close:focus-visible,
.pb-view-product-button:focus-visible {
	outline: 2px solid var(--wp--preset--color--accent, #007cba);
	outline-offset: 2px;
}
